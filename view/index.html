<!DOCTYPE html>
<html lang="{{ @this->lang() }}">
<head>
	<include href="blocks/head.html" />
	<style type="text/css">
		.list-group-item button {
			width: 16%;
			margin-bottom: 2px;
		}
	</style>
</head>
<body>
<include href="blocks/navbar.html" />
<div class="container">
	<p class="text-right">
		<a href="{{ @BASE }}/backlog/poker/results?{{ http_build_query(@@_GET ?: array()) }}" class="btn btn-default">View Results</a>
	</p>
	<div class="list-group">
		<repeat group="{{ @projects }}" value="{{ @project }}">
			<div class="list-group-item" data-project-id="{{ @project.id }}">
				<div class="row">
					<div class="col-sm-4 col-md-5">
						<h4><a href="{{ @BASE }}/issues/{{ @project.id }}">{{ @project.name | esc }}</a></h4>
						<div class="tex">{{ @project.description | parseText }}</div>
					</div>
					<div class="col-sm-8 col-md-7 text-right">
						<div>
							<button type="button" class="btn btn-default" data-val="0">0</button>
							<button type="button" class="btn btn-default" data-val="1">1</button>
							<button type="button" class="btn btn-default" data-val="2">2</button>
							<button type="button" class="btn btn-default" data-val="3">3</button>
							<button type="button" class="btn btn-default" data-val="5">5</button>
							<button type="button" class="btn btn-default" data-val="8">8</button>
						</div>
						<div>
							<button type="button" class="btn btn-default" data-val="13">13</button>
							<button type="button" class="btn btn-default" data-val="20">20</button>
							<button type="button" class="btn btn-default" data-val="40">40</button>
							<button type="button" class="btn btn-default" data-val="100">100</button>
							<button type="button" class="btn btn-default" data-val="?">?</button>
							<button type="button" class="btn btn-default" data-val="inf">&infin;</button>
						</div>
					</div>
				</div>
			</div>
		</repeat>
	</div>
	<include href="blocks/footer.html" />
</div>
<script type="text/javascript">
	/* global $, BASE */

	// Handle button clicks
	$('.list-group').on('click', '.btn', function(e) {
		$(this).parents('.list-group-item').find('.btn').removeClass('active');
		$(this).addClass('active');
		$.post(BASE + '/backlog/poker', {
			project_id: $(this).parents('.list-group-item').attr('data-project-id'),
			vote: $(this).attr('data-val')
		});
	});

	// Set active class on selected items
	var votes = JSON.parse('{{ json_encode(@votes) }}');
	$.each(votes, function() {
		$('.list-group-item')
			.filter('[data-project-id="' + this.project_id + '"]')
			.find('.btn[data-val="' + this.vote + '"]')
			.addClass('active');
	});
</script>
</body>
</html>
